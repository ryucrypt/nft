<!doctype html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" sizes="96x96" href="res/favi.png">
    <title>Brix Society x Alien Worlds</title>
    <meta property="og:title" content="Brix Society x Alien Worlds">
    <meta property="og:image" content="https://ryucrypt.github.io/nft/brix/res/favi.png">
    <meta property="og:description" content="Alien Worlds mining draws on Brix Society owned lands. Mine on Veles 28:12 or 14:9!">
    <meta property="og:type" content="website">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HG5WVNP5BP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-HG5WVNP5BP');
    </script>
</head>
<body>
    <div class="container">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="./aw.html" class="align-items-center me-auto text-dark text-decoration-none">
                <h2>Brix Society x Alien Worlds ðŸ‘½</h2>
                <p>Alien Worlds mining draws on Brix Society owned lands. Mine on Veles 28:12 or 14:9!</p>
            </a>
            <ul class="nav nav-pills">
                <li class="nav-item"><a href="./aw_stats.html" class="nav-link">Stats</a></li>
                <li class="nav-item"><a href="./aw.html" class="nav-link">Events</a></li>
            </ul>
        </header>
        <main>
            <div class="row my-3">
                <div class="col-md-3">
                    <p>Time Ending</p>
                    <select id="draws"></select>
                </div>
            </div>
            <div class="row mb-3">
                <div id="loading" class="d-flex justify-content-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
            <div class="row mb-3 visually-hidden" id="content">
                <div class="col">
                    <h5>Info:</h5>
                    <ul>
                        <li>Must hold this <a href="https://wax.atomichub.io/explorer/template/wax-mainnet/brixsocietyx/Brix-Society-Alien-Worlds-Whitelist_745964" target="_blank">whitelist NFT</a> to be eligible.</li>
                        <li>Every 0.1 TLM mined = 1 entry.</li>
                        <li>Max entries are capped at 20.</li>
                    </ul>
                    <p>Winner: <span id="winner">-</span> Prize: <span id="prize">-</span> Transaction: <span id="txn">-</span></p>
                </div>
                <div class="table-responsive mb-3">
                    <table
                        id="table"
                        class="table table-sm table-bordered text-center">
                        <thead>
                            <tr class="table-dark">
                                <th scope="col">Wallet</th>
                                <th scope="col">Entries</th>
                                <th scope="col">Whitelisted</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <div class="table-responsive">
                    <table
                        id="logs"
                        class="table table-sm table-bordered"
                        data-toggle="table"
                        data-show-footer="true"
                        data-filter-control="true">
                        <thead>
                            <tr class="table-dark">
                                <th scope="col" data-field="timestamp" data-formatter="timeFormatter" data-align="center">Timestamp</th>
                                <th scope="col" data-field="txn_id" data-formatter="txnFormatter" data-align="center">Transaction</th>
                                <th scope="col" data-field="miner" data-filter-control="input" data-formatter="urlFormatter" data-align="center">Miner</th>
                                <th scope="col" data-field="bounty" data-sortable="true" data-formatter="tlmFormatter" data-footer-formatter="totalBountyFormatter" data-align="center">Bounty (TLM)</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
        <footer>
            <div class="row justify-content-center border-top">
                <p class="text-center text-muted my-3">Made by ryucrypt: wwiem.wam</p>
                <p class="text-center text-muted mb-3">Interested in running your own mining event or promote your project via our pool? Contact <code>colosimo</code> in <a href="https://discord.gg/m9aSAEASjF" target="_blank">Brix Society Discord</a> for more info!</p>
            </div>
        </footer>
    </div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.21.4/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
const AH = "https://wax.atomichub.io/explorer/asset/wax-mainnet/";
const EXPLORER = "https://waxblock.io/";
var $logs = $("#logs");
var index = "";
var cur = "";
var winner = "";

const formatToken = (precision, amount) => {
    return (+(Math.round(+(amount/10 ** precision + 'e' + precision)) + 'e' + -precision)).toFixed(precision);
}

const fetchInfo = async(file) => {
    var url = `./res/draw/${file}.json`;
    var r = await fetch(url);
    var response = await r.json();
    return response;
}

const initialise = async() => {
    $("#draws").select2({
        theme: "bootstrap-5",
        width: "style"
    });

    index = await fetchInfo("index");
    for (let i = 0; i < index.length; i++) {
        if (i == 0) {
            item = new Option(index[i], i, true, true);
        } else {
            item = new Option(index[i], i, false, false);
        }
        $("#draws").append(item).trigger("change");
    }
    $("#draws").on("select2:select", async function(e) {
        await run(e.params.data.text);
    });

    await run(index[0]);
}

const run = async(draw) => {
    $("#content").addClass("visually-hidden");
    $("#loading").removeClass("visually-hidden");

    cur = await fetchInfo(draw);
    $("#table tbody").empty();
    for (let i of cur.entries) {
        if (i.wallet == cur.winner) {
            $("#table tbody").append(`<tr class="table-success"><td><a href="${EXPLORER + "account/" + i.wallet}" target="_blank">${i.wallet}</a></td><td>${i.entries}</td><td>${i.whitelisted}</td></tr>`);
        } else {
            $("#table tbody").append(`<tr><td><a href="${EXPLORER + "account/" + i.wallet}" target="_blank">${i.wallet}</a></td><td>${i.entries}</td><td>${i.whitelisted}</td></tr>`);
        }
    }
    $logs.bootstrapTable("load", cur.logs);
    $("#draws_lbl").html(draw);
    $("#winner").html(`<a href="${EXPLORER + "account/" + cur.winner}" target="_blank">${cur.winner}</a>`);
    $("#prize").html(`<a href="${AH + cur.prize_id}" target="_blank">${cur.prize_name}</a>`);
    $("#txn").html(`<a href="${EXPLORER + "transaction/" + cur.txn}" target="_blank">View</a>`);
    $("#content").removeClass("visually-hidden");
    $("#loading").addClass("visually-hidden");
}

function urlFormatter(value, row, index, field) {
    return `<a href="${EXPLORER + "account/" + value}" target="_blank">${value}</a>`;
}

function txnFormatter(value, row, index, field) {
    return `<a href="${EXPLORER + "transaction/" + value}" target="_blank">View</a>`;
}

function tlmFormatter(value, row, index, field) {
    return formatToken(4, value);
}

function timeFormatter(value, row, index, field) {
    return (new Date(value)).toLocaleString();
}

function totalBountyFormatter(data) {
    return formatToken(4, data.map(function (row) {
        return row.bounty;
    }).reduce(function (sum, i) {
        return sum + i
    }, 0));
}

initialise();
</script>
</body>
</html>
